{"version":3,"sources":["../../src/ios/Facebook.ts"],"names":["fbSchemes","withFacebook","setFacebookConfig","getFacebookScheme","config","facebookScheme","getFacebookAppId","facebookAppId","getFacebookDisplayName","facebookDisplayName","getFacebookAutoInitEnabled","facebookAutoInitEnabled","getFacebookAutoLogAppEvents","facebookAutoLogAppEventsEnabled","getFacebookAdvertiserIDCollection","facebookAdvertiserIDCollectionEnabled","infoPlist","setFacebookAppId","setFacebookApplicationQuerySchemes","setFacebookDisplayName","setFacebookAutoInitEnabled","setFacebookAutoLogAppEventsEnabled","setFacebookAdvertiserIDCollectionEnabled","setFacebookScheme","FacebookAutoInitEnabled","FacebookAutoLogAppEventsEnabled","FacebookAdvertiserIDCollectionEnabled","FacebookAppID","FacebookDisplayName","existingSchemes","LSApplicationQueriesSchemes","includes","length","restInfoPlist","scheme","index","findIndex","s","splice","updatedSchemes"],"mappings":"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","sourcesContent":["import { ExpoConfig } from '@expo/config-types';\n\nimport { createInfoPlistPlugin } from '../plugins/ios-plugins';\nimport { InfoPlist } from './IosConfig.types';\nimport { appendScheme } from './Scheme';\n\ntype ExpoConfigFacebook = Pick<\n  ExpoConfig,\n  | 'facebookScheme'\n  | 'facebookAdvertiserIDCollectionEnabled'\n  | 'facebookAppId'\n  | 'facebookAutoInitEnabled'\n  | 'facebookAutoLogAppEventsEnabled'\n  | 'facebookDisplayName'\n>;\n\nconst fbSchemes = ['fbapi', 'fb-messenger-api', 'fbauth2', 'fbshareextension'];\n\nexport const withFacebook = createInfoPlistPlugin(setFacebookConfig, 'withFacebook');\n\n/**\n * Getters\n * TODO: these getters are the same between ios/android, we could reuse them\n */\n\nexport function getFacebookScheme(config: ExpoConfigFacebook) {\n  return config.facebookScheme ?? null;\n}\n\nexport function getFacebookAppId(config: Pick<ExpoConfigFacebook, 'facebookAppId'>) {\n  return config.facebookAppId ?? null;\n}\n\nexport function getFacebookDisplayName(config: ExpoConfigFacebook) {\n  return config.facebookDisplayName ?? null;\n}\nexport function getFacebookAutoInitEnabled(config: ExpoConfigFacebook) {\n  return config.facebookAutoInitEnabled ?? null;\n}\n\nexport function getFacebookAutoLogAppEvents(config: ExpoConfigFacebook) {\n  return config.facebookAutoLogAppEventsEnabled ?? null;\n}\n\nexport function getFacebookAdvertiserIDCollection(config: ExpoConfigFacebook) {\n  return config.facebookAdvertiserIDCollectionEnabled ?? null;\n}\n\n/**\n * Setters\n */\n\nexport function setFacebookConfig(config: ExpoConfigFacebook, infoPlist: InfoPlist) {\n  infoPlist = setFacebookAppId(config, infoPlist);\n  infoPlist = setFacebookApplicationQuerySchemes(config, infoPlist);\n  infoPlist = setFacebookDisplayName(config, infoPlist);\n  infoPlist = setFacebookAutoInitEnabled(config, infoPlist);\n  infoPlist = setFacebookAutoLogAppEventsEnabled(config, infoPlist);\n  infoPlist = setFacebookAdvertiserIDCollectionEnabled(config, infoPlist);\n  infoPlist = setFacebookScheme(config, infoPlist);\n  return infoPlist;\n}\n\nexport function setFacebookScheme(config: ExpoConfigFacebook, infoPlist: InfoPlist) {\n  const facebookScheme = getFacebookScheme(config);\n  return appendScheme(facebookScheme, infoPlist);\n}\n\nexport function setFacebookAutoInitEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAutoInitEnabled, ...infoPlist }: InfoPlist\n) {\n  const facebookAutoInitEnabled = getFacebookAutoInitEnabled(config);\n\n  if (facebookAutoInitEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAutoInitEnabled: facebookAutoInitEnabled,\n  };\n}\n\nexport function setFacebookAutoLogAppEventsEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAutoLogAppEventsEnabled, ...infoPlist }: InfoPlist\n) {\n  const facebookAutoLogAppEventsEnabled = getFacebookAutoLogAppEvents(config);\n\n  if (facebookAutoLogAppEventsEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAutoLogAppEventsEnabled: facebookAutoLogAppEventsEnabled,\n  };\n}\n\nexport function setFacebookAdvertiserIDCollectionEnabled(\n  config: ExpoConfigFacebook,\n  { FacebookAdvertiserIDCollectionEnabled, ...infoPlist }: InfoPlist\n) {\n  const facebookAdvertiserIDCollectionEnabled = getFacebookAdvertiserIDCollection(config);\n\n  if (facebookAdvertiserIDCollectionEnabled === null) {\n    return infoPlist;\n  }\n\n  return {\n    ...infoPlist,\n    FacebookAdvertiserIDCollectionEnabled: facebookAdvertiserIDCollectionEnabled,\n  };\n}\n\nexport function setFacebookAppId(\n  config: Pick<ExpoConfigFacebook, 'facebookAppId'>,\n  { FacebookAppID, ...infoPlist }: InfoPlist\n) {\n  const facebookAppId = getFacebookAppId(config);\n  if (facebookAppId) {\n    return {\n      ...infoPlist,\n      FacebookAppID: facebookAppId,\n    };\n  }\n\n  return infoPlist;\n}\n\nexport function setFacebookDisplayName(\n  config: ExpoConfigFacebook,\n  { FacebookDisplayName, ...infoPlist }: InfoPlist\n) {\n  const facebookDisplayName = getFacebookDisplayName(config);\n\n  if (facebookDisplayName) {\n    return {\n      ...infoPlist,\n      FacebookDisplayName: facebookDisplayName,\n    };\n  }\n\n  return infoPlist;\n}\n\nexport function setFacebookApplicationQuerySchemes(\n  config: Pick<ExpoConfigFacebook, 'facebookAppId'>,\n  infoPlist: InfoPlist\n): InfoPlist {\n  const facebookAppId = getFacebookAppId(config);\n\n  const existingSchemes = infoPlist.LSApplicationQueriesSchemes || [];\n\n  if (facebookAppId && existingSchemes.includes('fbapi')) {\n    // already inlcuded, no need to add again\n    return infoPlist;\n  } else if (!facebookAppId && !existingSchemes.length) {\n    // already removed, no need to strip again\n    const { LSApplicationQueriesSchemes, ...restInfoPlist } = infoPlist;\n    if (LSApplicationQueriesSchemes?.length) {\n      return infoPlist;\n    } else {\n      // Return without the empty LSApplicationQueriesSchemes array.\n      return restInfoPlist;\n    }\n  }\n\n  // Remove all schemes\n  for (const scheme of fbSchemes) {\n    const index = existingSchemes.findIndex(s => s === scheme);\n    if (index > -1) {\n      existingSchemes.splice(index, 1);\n    }\n  }\n\n  if (!facebookAppId) {\n    // Run again to ensure the LSApplicationQueriesSchemes array is stripped if needed.\n    infoPlist.LSApplicationQueriesSchemes = existingSchemes;\n    if (!infoPlist.LSApplicationQueriesSchemes.length) {\n      delete infoPlist.LSApplicationQueriesSchemes;\n    }\n    return infoPlist;\n  }\n\n  // TODO: it's actually necessary to add more query schemes (specific to the\n  // app) to support all of the features that the Facebook SDK provides, should\n  // we sync those here too?\n  const updatedSchemes = [...existingSchemes, ...fbSchemes];\n\n  return {\n    ...infoPlist,\n    LSApplicationQueriesSchemes: updatedSchemes,\n  };\n}\n"],"file":"Facebook.js"}