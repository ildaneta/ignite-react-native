{"version":3,"file":"NavigationBar.js","sourceRoot":"","sources":["../../src/android/NavigationBar.ts"],"names":[],"mappings":"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","sourcesContent":["import { ExpoConfig } from '@expo/config-types';\n\nimport { ConfigPlugin } from '../Plugin.types';\nimport { withDangerousMod } from '../plugins/withDangerousMod';\nimport { writeXMLAsync } from '../utils/XML';\nimport * as WarningAggregator from '../utils/warnings';\nimport { getProjectColorsXMLPathAsync, setColorItem } from './Colors';\nimport { buildResourceItem, readResourcesXMLAsync } from './Resources';\nimport { getProjectStylesXMLPathAsync, setStylesItem } from './Styles';\n\nconst NAVIGATION_BAR_COLOR = 'navigationBarColor';\nconst WINDOW_LIGHT_NAVIGATION_BAR = 'android:windowLightNavigationBar';\n\nexport const withNavigationBar: ConfigPlugin = config => {\n  return withDangerousMod(config, [\n    'android',\n    async config => {\n      await setNavigationBarConfig(config, config.modRequest.projectRoot);\n      return config;\n    },\n  ]);\n};\n\nexport function getNavigationBarImmersiveMode(config: Pick<ExpoConfig, 'androidNavigationBar'>) {\n  return config.androidNavigationBar?.visible || null;\n}\n\nexport function getNavigationBarColor(config: Pick<ExpoConfig, 'androidNavigationBar'>) {\n  return config.androidNavigationBar?.backgroundColor || null;\n}\n\nexport function getNavigationBarStyle(config: Pick<ExpoConfig, 'androidNavigationBar'>) {\n  return config.androidNavigationBar?.barStyle || 'light-content';\n}\n\nexport async function setNavigationBarConfig(\n  config: Pick<ExpoConfig, 'androidNavigationBar'>,\n  projectRoot: string\n) {\n  const immersiveMode = getNavigationBarImmersiveMode(config);\n  const hexString = getNavigationBarColor(config);\n  const barStyle = getNavigationBarStyle(config);\n\n  const stylesPath = await getProjectStylesXMLPathAsync(projectRoot);\n  const colorsPath = await getProjectColorsXMLPathAsync(projectRoot);\n\n  let stylesJSON = await readResourcesXMLAsync({ path: stylesPath });\n  let colorsJSON = await readResourcesXMLAsync({ path: colorsPath });\n\n  if (immersiveMode) {\n    // Immersive mode needs to be set programatically\n    WarningAggregator.addWarningAndroid(\n      'androidNavigationBar.visible',\n      'Hiding the navigation bar must be done programmatically. Refer to the Android documentation - https://developer.android.com/training/system-ui/immersive - for instructions.'\n    );\n  }\n  if (hexString) {\n    const colorItemToAdd = buildResourceItem({ name: NAVIGATION_BAR_COLOR, value: hexString });\n    colorsJSON = setColorItem(colorItemToAdd, colorsJSON);\n\n    const styleItemToAdd = buildResourceItem({\n      name: `android:${NAVIGATION_BAR_COLOR}`,\n      value: `@color/${NAVIGATION_BAR_COLOR}`,\n    });\n    stylesJSON = setStylesItem({\n      item: styleItemToAdd,\n      xml: stylesJSON,\n      parent: { name: 'AppTheme', parent: 'Theme.AppCompat.Light.NoActionBar' },\n    });\n  }\n  if (barStyle === 'dark-content') {\n    const navigationBarStyleItem = buildResourceItem({\n      name: WINDOW_LIGHT_NAVIGATION_BAR,\n      value: 'true',\n    });\n    stylesJSON = setStylesItem({\n      item: navigationBarStyleItem,\n      xml: stylesJSON,\n      parent: { name: 'AppTheme', parent: 'Theme.AppCompat.Light.NoActionBar' },\n    });\n  }\n\n  try {\n    await Promise.all([\n      writeXMLAsync({ path: colorsPath, xml: colorsJSON }),\n      writeXMLAsync({ path: stylesPath, xml: stylesJSON }),\n    ]);\n  } catch (e) {\n    throw new Error(\n      `Error setting Android navigation bar color. Cannot write colors.xml to ${colorsPath}, or styles.xml to ${stylesPath}.`\n    );\n  }\n  return true;\n}\n"]}